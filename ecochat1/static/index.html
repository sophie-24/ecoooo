<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>EcoChat · 탄소 절감 챗봇</title>
  <style>
    body{font-family:sans-serif;background:#0f172a;color:#e5e7eb;display:flex;align-items:center;justify-content:center;min-height:100vh}
    .chat{width:600px;background:#111827;border-radius:16px;box-shadow:0 4px 20px #0006;display:flex;flex-direction:column;overflow:hidden}
    .msgs{flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;background:#0b132b}
    .bubble{padding:10px 14px;border-radius:12px;max-width:75%}
    .me{background:#10b981;color:#052e1a;align-self:flex-end}
    .bot{background:#1f2937;color:#e5e7eb;align-self:flex-start}
    .bar{display:flex;padding:10px;background:#0d1b2a;gap:8px}
    input{flex:1;padding:8px;border-radius:8px;border:none}
    button{padding:8px 12px;border:none;border-radius:8px;background:#10b981;color:#052e1a;cursor:pointer}
  </style>
</head>
<body>
  <div class="chat">
    <div id="msgs" class="msgs"></div>
    <div class="bar">
      <input id="username" placeholder="사용자명"/>
      <button onclick="createUser()">사용자 생성</button>
    </div>
    <div class="bar">
      <input id="distance" type="number" step="0.1" placeholder="거리(km)"/>
      <button onclick="quick('bus')">버스</button>
      <button onclick="quick('subway')">지하철</button>
      <button onclick="quick('train')">기차</button>
      <button onclick="quick('walk')">도보</button>
      <button onclick="quick('bike')">자전거</button>
    </div>
  </div>
  <script>
    const msgs=document.getElementById('msgs');let userId=null;
    function bubble(t,who='bot'){let b=document.createElement('div');b.className='bubble '+who;b.textContent=t;msgs.appendChild(b);msgs.scrollTop=msgs.scrollHeight;}
    async function api(path,opt){let r=await fetch(path,opt);if(!r.ok)throw new Error(await r.text());return r.json();}
    async function createUser(){const name=document.getElementById('username').value.trim();if(!name){alert("이름 입력");return;}
      const d=await api('/users',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:name})});
      userId=d.user_id;bubble(`환영합니다 ${d.username} (id=${userId})`);}
    async function quick(mode){const d=parseFloat(document.getElementById('distance').value);if(!userId){bubble("먼저 사용자 생성하세요");return;}
      const trip=await api('/trips',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:userId,mode,distance_km:d})});
      bubble(`${mode} ${d}km → ${(trip.co2_saved_g/1000).toFixed(2)}kg CO₂ 절감, +${trip.points_earned}p`,'me');}
  </script>
</body>
</html>
